'use strict';(function(){function a(a){return Array.prototype.slice.call(a)}function b(a){return new Promise(function(b,c){a.onsuccess=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function c(a,c,d){var e,f=new Promise(function(f,g){e=a[c].apply(a,d),b(e).then(f,g)});return f.request=e,f}function d(a,b,d){var e=c(a,b,d);return e.then(function(a){return a?new j(a,e.request):void 0})}function e(a,b,c){c.forEach(function(c){Object.defineProperty(a.prototype,c,{get:function(){return this[b][c]},set:function(a){this[b][c]=a}})})}function f(a,b,d,e){e.forEach(function(e){e in d.prototype&&(a.prototype[e]=function(){return c(this[b],e,arguments)})})}function g(a,b,c,d){d.forEach(function(d){d in c.prototype&&(a.prototype[d]=function(){return this[b][d].apply(this[b],arguments)})})}function h(a,b,c,e){e.forEach(function(e){e in c.prototype&&(a.prototype[e]=function(){return d(this[b],e,arguments)})})}function i(a){this._index=a}function j(a,b){this._cursor=a,this._request=b}function k(a){this._store=a}function l(a){this._tx=a,this.complete=new Promise(function(b,c){a.oncomplete=function(){b()},a.onerror=function(){c(a.error)},a.onabort=function(){c(a.error)}})}function m(a,b,c){this._db=a,this.oldVersion=b,this.transaction=new l(c)}function n(a){this._db=a}e(i,'_index',['name','keyPath','multiEntry','unique']),f(i,'_index',IDBIndex,['get','getKey','getAll','getAllKeys','count']),h(i,'_index',IDBIndex,['openCursor','openKeyCursor']),e(j,'_cursor',['direction','key','primaryKey','value']),f(j,'_cursor',IDBCursor,['update','delete']),['advance','continue','continuePrimaryKey'].forEach(function(a){a in IDBCursor.prototype&&(j.prototype[a]=function(){var c=this,d=arguments;return Promise.resolve().then(function(){return c._cursor[a].apply(c._cursor,d),b(c._request).then(function(a){return a?new j(a,c._request):void 0})})})}),k.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},k.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(k,'_store',['name','keyPath','indexNames','autoIncrement']),f(k,'_store',IDBObjectStore,['put','add','delete','clear','get','getAll','getKey','getAllKeys','count']),h(k,'_store',IDBObjectStore,['openCursor','openKeyCursor']),g(k,'_store',IDBObjectStore,['deleteIndex']),l.prototype.objectStore=function(){return new k(this._tx.objectStore.apply(this._tx,arguments))},e(l,'_tx',['objectStoreNames','mode']),g(l,'_tx',IDBTransaction,['abort']),m.prototype.createObjectStore=function(){return new k(this._db.createObjectStore.apply(this._db,arguments))},e(m,'_db',['name','version','objectStoreNames']),g(m,'_db',IDBDatabase,['deleteObjectStore','close']),n.prototype.transaction=function(){return new l(this._db.transaction.apply(this._db,arguments))},e(n,'_db',['name','version','objectStoreNames']),g(n,'_db',IDBDatabase,['close']),['openCursor','openKeyCursor'].forEach(function(b){[k,i].forEach(function(c){b in c.prototype&&(c.prototype[b.replace('open','iterate')]=function(){var c=a(arguments),d=c[c.length-1],e=this._store||this._index,f=e[b].apply(e,c.slice(0,-1));f.onsuccess=function(){d(f.result)}})})}),[i,k].forEach(function(a){a.prototype.getAll||(a.prototype.getAll=function(a,b){var c=this,d=[];return new Promise(function(e){c.iterateCursor(a,function(a){return a?(d.push(a.value),void 0!==b&&d.length==b?void e(d):void a.continue()):void e(d)})})})});var o={open:function(a,b,d){var e=c(indexedDB,'open',[a,b]),f=e.request;return f&&(f.onupgradeneeded=function(a){d&&d(new m(f.result,a.oldVersion,f.transaction))}),e.then(function(a){return new n(a)})},delete:function(a){return c(indexedDB,'deleteDatabase',[a])}};'undefined'==typeof module?self.idb=o:(module.exports=o,module.exports.default=module.exports)})();